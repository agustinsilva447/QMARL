import copy
import numpy as np
import matplotlib.pyplot as plt

q_noise = [0.000, 0.001, 0.003, 0.010, 0.030, 0.100, 0.300, 1.000]

eps1 = [1e-3, 1e-4, 1e-5, 1e-6,  1e-7,  1e-8,   1e-9]
alp1 = [0.1,  0.03, 0.01, 0.003, 0.001, 0.0003, 0.0001]
para1 = []
for e in eps1:
    for a in alp1:
        para1.append([e,a])

eps2 = [1e-5,  1e-6,  1e-7,  1e-8,  1e-9]
alp2 = [0.1,   0.01,  0.003, 0.001, 0.0001]
para2 = []
for e in eps2:
    for a in alp2:
        para2.append([e,a])


avg_rew_n0_000 = [0.22343361255072233, 0.5378583883788979, 1.4166368431024734, 0.7419846404139326, 0.4828159724923164, 0.7759253458018465, 0.9446712484530957, 0.19024477923466235, 0.7947360500265049, 1.078583682007112, 0.7295669064303325, 0.7815078909822771, 0.6310547778233954, 0.6467612838802238, 0.2512346337086356, 0.5321071980488671, 1.1850242807108557, 1.1230068517447067, 0.459093048912344, 1.0391571333265286, 0.6512521325821018, 0.2787528204553204, 0.5767681065132299, 1.0333890111001687, 0.7275603252270583, 0.5407215248026569, 1.2593709187552362, 1.4373986809375325, 0.2104504701749075, 0.4773569697392787, 1.1486576564386717, 0.7342148020729291, 0.517098108381642, 0.6367514721658244, 0.5866255184646912, 0.1039522052154127, 0.5552398755917972, 0.9717589320298672, 0.8434981340915966, 0.7095672260204958, 0.5284822029292854, 1.0440572026486319, 0.13815461516815497, 0.49918630377683615, 1.752541009721302, 0.9772434269138123, 0.657010099852494, 0.47861411659803976, 0.8164452448273873]
far_fac_n0_000 = [0.5791725644507524, 0.7923002007308901, 0.5956298510688668, 0.7884078893435378, 0.6043832884145274, 0.5219032965272877, 0.7337229662524494, 0.6290220792156314, 0.5400657383781139, 0.6846393509605061, 0.7765680609260476, 0.8059099696900891, 0.7477995068398647, 0.7129482830949536, 0.6732198404434151, 0.6429897247903906, 0.6254881337687699, 0.7574711492715763, 0.6574759641777415, 0.7006904300504624, 0.6744213801243227, 0.5221463495454958, 0.7366001750628351, 0.7341255913622814, 0.8120369274082166, 0.7313084992461483, 0.6022952332233411, 0.5141942510711512, 0.6061243220124408, 0.9167465067478816, 0.8238488210506765, 0.8132374130618925, 0.8526056949632782, 0.7580012523702319, 0.6015000895044132, 0.8479443924194965, 0.7808812704069236, 0.8174382324633424, 0.7119366666235117, 0.7111067793124094, 0.8866656681730647, 0.6824736326668704, 0.7327412384418918, 0.7054008421633531, 0.5717984759577857, 0.5921095066196981, 0.5815554837255298, 0.6424596414700516, 0.6824408113979529]
arr_rew_n0_000 = np.array(avg_rew_n0_000)
arr_fac_n0_000 = np.array(far_fac_n0_000)

avg_rew_n0_001 = [1.4066244367083895, 1.0100834031197736, 0.8940155900666834, 0.7163599562548891, 1.0828395887028284, 0.5336250726043343, 1.2537996466697439, 1.6706590326648634, 1.1422801300574215, 0.8642705309974157, 0.5204864551655517, 1.1328821084247587, 2.065863766259732, 1.24267963795875, 1.5062250967311221, 1.2417130764857007, 1.116321187196864, 0.6913245747492625, 0.43981755195378625, 1.7610626121465893, 1.902644989551678, 1.470554852816811, 1.307492688662984, 0.7532904738665327, 0.7893156648994325, 0.7279376196014661, 2.4539110645202964, 1.8749868662476652, 1.53765404132704, 1.2826143808884618, 0.9765305227429472, 0.7769440516420257, 1.2566900771230824, 1.8426014980207903, 4.111984576900125, 1.4935593419789324, 1.3299364298271565, 1.169905817484588, 0.8397845877675602, 1.0519639624325836, 1.8170686421415485, 0.6891621052481518, 1.6889458249343783, 1.4322991109700407, 0.8197601949027343, 0.529985334638676, 1.1185237554758307, 0.9154100480853203, 3.6978860336553474]
far_fac_n0_001 = [0.9532842271207803, 0.8803604611004101, 0.8403725820325262, 0.6316976177117464, 0.6013609332231998, 0.6625103465579015, 0.5672319584428039, 0.9444576594464615, 0.8644515332361578, 0.91554440361973, 0.6908496320588153, 0.552504739083324, 0.3275234773321872, 0.6243490985824475, 0.9621278280305499, 0.8287227811144493, 0.7009261301499204, 0.5513137411291347, 0.47704706317581813, 0.7643079889982647, 0.6825838486989401, 0.9551572733767587, 0.8595021493520281, 0.7924229833193177, 0.6129620733461553, 0.4068399832869792, 0.6707290336823589, 0.645909457307287, 0.9188568112364018, 0.88410563887008, 0.7159133968698175, 0.691856356631506, 0.1905031050570314, 0.4519646529888899, 0.3700678431707611, 0.9580699953103982, 0.8627282029172071, 0.6134738818341953, 0.7115487206371941, 0.7020982803318261, 0.42799526831851387, 0.4918436824032355, 0.951975077040736, 0.8541685979165567, 0.7898661491754788, 0.30172128020926225, 0.4928199058882711, 0.5847511697400879, 0.6189959720452951]
arr_rew_n0_001 = np.array(avg_rew_n0_001)
arr_fac_n0_001 = np.array(far_fac_n0_001)

avg_rew_n0_003 = [1.5977313764701468, 0.8497533224053821, 0.8861289794907521, 2.5334589525457574, 2.4260541075719373, 1.5178262819531634, 0.8057412143260871, 0.6143665314154637, 0.8857141564461775, 1.2294642329263676, 1.480502055941769, 0.8733850275176207, 1.1598978222345633, 0.42169665377474014, 1.935544702925098, 1.5044369949368148, 0.8198905325659835, 1.9243548121903102, 1.0455357948464115, 0.7084508561618412, 1.4700480111145078, 1.006786959906447, 0.9137447984503679, 2.9940858429216433, 0.37546177307510314]
far_fac_n0_003 = [0.955123674933315, 0.8940735059384829, 0.5852279914227456, 0.6455521508379547, 0.5725536013925011, 0.9687021491013741, 0.8797986348166975, 0.6988585484487335, 0.44566778521982575, 0.5802929402704015, 0.9658936512810609, 0.923615783838704, 0.7645119621111038, 0.5063694060868213, 0.246714701715342, 0.9816252511663297, 0.8671126086787219, 0.49814115761609107, 0.590666775939162, 0.355561683182931, 0.9791019361861112, 0.6652785752990658, 0.7836816387395762, 0.3801518713203366, 0.40689535722034165]
arr_rew_n0_003 = np.array(avg_rew_n0_003)
arr_fac_n0_003 = np.array(far_fac_n0_003)

avg_rew_n0_010 = [1.411545611167598, 0.6545102512650584, 2.4907358277563065, 1.3447557297961519, 1.7832567584638426, 1.4651245003071984, 0.8946990553784252, 1.408527510518447, 0.9391383834245087, 1.7403780533028177, 1.3858713872654895, 0.889333585611484, 0.8724214404862254, 0.7040538751494968, 0.59833307403648, 1.3559942212387328, 0.8174902573832614, 0.9253152063848529, 3.3902460144239224, 1.6647955422623653, 1.4413081188316283, 0.899193163680838, 1.4969012505400043, 2.4865891766728585, 1.119965949331409]
far_fac_n0_010 = [0.9591882257484872, 0.8918396428778387, 0.42683822553593825, 0.8566916638544837, 0.590712862552087, 0.9778529747404491, 0.9123252007058933, 0.4040420911493331, 0.4853905337698111, 0.4468276875315719, 0.9812970979958524, 0.7640754374609047, 0.47688067074811225, 0.5430252974682744, 0.4434094887893814, 0.9775085624317237, 0.9119364924068298, 0.5695436032618268, 0.47460436559536445, 0.7336520661438594, 0.9666960446563495, 0.8434607793793815, 0.40403433665300714, 0.4128975170182691, 0.6607697123129566]
arr_rew_n0_010 = np.array(avg_rew_n0_010)
arr_fac_n0_010 = np.array(far_fac_n0_010)

avg_rew_n0_030 = [1.3252493721264411, 1.3510668895227778, 1.5052628821342786, 0.761108762604079, 1.5231595939845708, 1.3231667847074982, 0.8735189586694135, 0.9731995039529651, 1.2048398278355743, 1.0648816843785742, 1.3143463719297817, 1.2224748159869476, 2.9777762526876606, 2.0530419400930753, 2.04970658877413, 1.3459718864555044, 1.0449326155647012, 0.5682177443665523, 0.7897781060042318, 0.7589401851939795, 1.296824983278488, 0.8219246360365404, 2.298630849844929, 0.5693996146256153, 1.4536450609988494]
far_fac_n0_030 = [0.9755416336329418, 0.8328019491689608, 0.5606460782676902, 0.7621584717448427, 0.42177804628299564, 0.9757570757374154, 0.8320031603004601, 0.8103692174448006, 0.745275679275837, 0.6100874811272228, 0.9656008437424711, 0.6452611425542915, 0.625634338965209, 0.41506291360920616, 0.48353477386452387, 0.9750227060653771, 0.7791103485910102, 0.7940233111824895, 0.407473583442819, 0.5754462819653731, 0.9849894681485268, 0.8839135797424292, 0.5935226677975252, 0.509830937414374, 0.6006097954795635]
arr_rew_n0_030 = np.array(avg_rew_n0_030)
arr_fac_n0_030 = np.array(far_fac_n0_030)

avg_rew_n0_100 = [0.40136275333586635]
far_fac_n0_100 = [0.62178723085159]
arr_rew_n0_100 = np.array(avg_rew_n0_100)
arr_fac_n0_100 = np.array(far_fac_n0_100)

avg_rew_n0_300 = [1.3933982028766678]
far_fac_n0_300 = [0.4313656140188124]
arr_rew_n0_300 = np.array(avg_rew_n0_300)
arr_fac_n0_300 = np.array(far_fac_n0_300)

avg_rew_n1_000 = [1.0283479381705958]
far_fac_n1_000 = [0.9867347818626889]
arr_rew_n1_000 = np.array(avg_rew_n1_000)
arr_fac_n1_000 = np.array(far_fac_n1_000)

arr_rew = [arr_rew_n0_000,
           arr_rew_n0_001,
           arr_rew_n0_003,
           arr_rew_n0_010,
           arr_rew_n0_030,
           arr_rew_n0_100,
           arr_rew_n0_300,
           arr_rew_n1_000]
arr_fac = [arr_fac_n0_000,
           arr_fac_n0_001,
           arr_fac_n0_003,
           arr_fac_n0_010,
           arr_fac_n0_030,
           arr_fac_n0_100,
           arr_fac_n0_300,
           arr_fac_n1_000]

best_rwg = []
for i, (l, n) in enumerate(zip(arr_rew, arr_fac)):    
    print("\n ---> Best rewards and fairness for quantum noise = {}".format(q_noise[i]))
    copy_rew = copy.deepcopy(l)
    sorted_array = np.sort(copy_rew)[::-1]    
    best_rwg.append(sorted_array[0])
    for rewi in sorted_array:
        id_rew = np.where(rewi == l)
        id_fac = n[id_rew[0][0]]
        if len(l)==49:
            hypara = para1[id_rew[0][0]]
        if len(l)==25:
            hypara = para2[id_rew[0][0]]
        print("Average reward = {:.6f}. Fairness factor = {:.6f}. Delta epsilon = {}. Learning rate = {}.".format(rewi, id_fac, hypara[0], hypara[1]))

bestbest = np.max(best_rwg)
id_best  = np.where(best_rwg == bestbest)
id_rew   = np.where(arr_rew[id_best[0][0]] == bestbest)
hypara = para1[id_rew[0][0]]
print("Best average rewards = {}. Quantum noise = {}. Delta epsilon = {}. Learning rate = {}".format(best_rwg[id_best[0][0]], q_noise[id_best[0][0]], hypara[0], hypara[1]))

plt.title("Avg Reward vs Quantum Noise")
plt.plot(q_noise, best_rwg)
plt.xlabel("Quantum Noise")
plt.ylabel("Avg Reward")
plt.show()